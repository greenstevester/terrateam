---
title: Kubernetes Deployment
description: Deploy Terrateam Self-Hosted on Kubernetes using Helm charts for GitHub and GitLab.
---

import { Steps } from '@astrojs/starlight/components';

Kubernetes deployment with Helm provides a production-ready, scalable solution for Terrateam Self-Hosted. This method is recommended for enterprise environments requiring high availability and automatic scaling, and supports both GitHub and GitLab.

## Prerequisites

Before you begin, ensure you have:
- **Kubernetes cluster** (v1.19+)
- **Helm 3** installed
- **kubectl** configured to access your cluster
- **GitHub Application or GitLab configuration** already created (see [Getting Started](/self-hosted/getting-started/))

## Installation Steps

### GitHub Setup

<Steps>

1. **Source your GitHub Application settings**

   If you haven't created a GitHub Application yet, follow the [Docker Compose Setup](/self-hosted/docker-compose/) guide first to create the application, then return here.

   ```sh
   source ./dotenv
   ```

2. **Create Kubernetes secrets for GitHub App**

   Create secrets for your private Terrateam GitHub Application:

   ```sh
   kubectl create secret generic terrateam-github-app-pem \
     --from-literal=pem="$GITHUB_APP_PEM"
   
   kubectl create secret generic terrateam-github-webhook-secret \
     --from-literal=secret="$GITHUB_WEBHOOK_SECRET"
   
   kubectl create secret generic terrateam-github-app-client-secret \
     --from-literal=secret="$GITHUB_APP_CLIENT_SECRET"
   
   kubectl create secret generic terrateam-github-app-client-id \
     --from-literal=id="$GITHUB_APP_CLIENT_ID"
   
   kubectl create secret generic terrateam-github-app-id \
     --from-literal=id="$GITHUB_APP_ID"
   ```

3. **Create database password secret**

   ```sh
   kubectl create secret generic terrateam-db-password \
     --from-literal=password="STRONG_PASSWORD_HERE"
   ```

   :::danger[Security]
   Replace `STRONG_PASSWORD_HERE` with a secure, randomly generated password.
   :::

4. **Add Terrateam Helm repository**

   ```sh
   helm repo add terrateamio https://terrateamio.github.io/helm-charts/
   helm repo update
   ```

   :::tip[Customization]
   View the Helm chart source and all available configuration options on [GitHub](https://github.com/terrateamio/helm-charts/tree/main/charts/terrateam).
   :::

5. **Choose your deployment configuration**

   Select one of the deployment options below based on your infrastructure.

</Steps>

### GitLab Setup

<Steps>

1. **Source your GitLab configuration**

   If you haven't configured GitLab yet, follow the [Docker Compose Setup](/self-hosted/docker-compose/) guide first to generate the configuration, then return here.

   ```sh
   source ./dotenv
   ```

2. **Create Kubernetes secrets for GitLab**

   Create secrets for your GitLab configuration:

   ```sh
   kubectl create secret generic terrateam-gitlab-app-id \
     --from-literal=id="$GITLAB_APP_ID"
   
   kubectl create secret generic terrateam-gitlab-app-secret \
     --from-literal=secret="$GITLAB_APP_SECRET"
   
   kubectl create secret generic terrateam-gitlab-access-token \
     --from-literal=token="$GITLAB_ACCESS_TOKEN"
   ```

3. **Create database password secret**

   ```sh
   kubectl create secret generic terrateam-db-password \
     --from-literal=password="STRONG_PASSWORD_HERE"
   ```

   :::danger[Security]
   Replace `STRONG_PASSWORD_HERE` with a secure, randomly generated password.
   :::

4. **Add Terrateam Helm repository**

   ```sh
   helm repo add terrateamio https://terrateamio.github.io/helm-charts/
   helm repo update
   ```

   :::tip[Customization]
   View the Helm chart source and all available configuration options on [GitHub](https://github.com/terrateamio/helm-charts/tree/main/charts/terrateam).
   :::

5. **Choose your deployment configuration**

   Select one of the deployment options below based on your infrastructure.

</Steps>

## Deployment Options

### GKE with HTTPS Load Balancer

For Google Kubernetes Engine with managed SSL certificates:

<Steps>

1. **Create a global static IP address:**
   ```sh
   gcloud compute addresses create terrateam-static-ip --global
   ```

2. **Get the IP address:**
   ```sh
   gcloud compute addresses describe terrateam-static-ip --global
   ```

3. **Configure DNS**
   
   Add the static IP to your DNS zone as `terrateam.example.com`

4. **Install with Helm:**

   For GitHub:
   ```sh
   helm install terrateam terrateamio/terrateam \
     --set terrateam.config.fqdn="terrateam.example.com" \
     --set terrateam.config.vcs="github" \
     --set ingress.certificate.enabled="true" \
     --set ingress.enabled="true" \
     --set ingress.annotations."networking\.gke\.io\/managed-certificates"="terrateam-ingress-certificate" \
     --set ingress.annotations."kubernetes\.io\/ingress\.global-static-ip-name"="terrateam-static-ip" \
     --set ingress.annotations."kubernetes\.io\/ingress\.class"="gce" \
     --set-string ingress.annotations."kubernetes\.io\/ingress\.allow-http"="false"
   ```

   For GitLab:
   ```sh
   helm install terrateam terrateamio/terrateam \
     --set terrateam.config.fqdn="terrateam.example.com" \
     --set terrateam.config.github.enabled=false \
     --set terrateam.config.gitlab.enabled=true \
     --set ingress.certificate.enabled="true" \
     --set ingress.enabled="true" \
     --set ingress.annotations."networking\.gke\.io\/managed-certificates"="terrateam-ingress-certificate" \
     --set ingress.annotations."kubernetes\.io\/ingress\.global-static-ip-name"="terrateam-static-ip" \
     --set ingress.annotations."kubernetes\.io\/ingress\.class"="gce" \
     --set-string ingress.annotations."kubernetes\.io\/ingress\.allow-http"="false"
   ```

</Steps>

:::note[Certificate Provisioning]
Google-managed SSL certificates with Ingress can take up to 60 minutes to configure. The Ingress may show as ready while the certificate is still provisioning.
:::

### Without Ingress

For clusters without ingress controllers:

For GitHub:
```sh
helm install terrateam terrateamio/terrateam \
  --set terrateam.config.fqdn="terrateam.example.com"
```

For GitLab:
```sh
helm install terrateam terrateamio/terrateam \
  --set terrateam.config.fqdn="terrateam.example.com" \
  --set terrateam.config.github.enabled=false \
  --set terrateam.config.gitlab.enabled=true
```

You can later expose the `terrateam-server` service using:
- [NGINX Ingress Controller](https://cert-manager.io/docs/tutorials/acme/nginx-ingress/)
- [cert-manager](https://github.com/cert-manager/cert-manager) for SSL certificates

## Configure Webhook URLs

#### GitHub
For GitHub, you need to configure the webhook URL in your GitHub App settings:

1. Navigate to your GitHub App settings page
2. Go to the "General" tab
3. In the "Webhook" section, set the URL to: `https://terrateam.example.com/api/github/v1/events`
4. Ensure the webhook secret matches the one you configured during setup
5. Save your changes

:::note[Webhook Path]
Always include the trailing `/api/github/v1/events` path for GitHub webhooks.
:::

#### GitLab
For GitLab, you'll need to configure webhooks in your GitLab projects:

1. Navigate to your GitLab project settings
2. Go to Settings â†’ Webhooks
3. Add webhook URL: `https://terrateam.example.com/api/gitlab/v1/events`
4. Select the following events:
   - Push events
   - Merge request events
   - Comments
   - Pipeline events

### Enable Terrateam UI Access

#### GitHub
To enable the Terrateam web UI for GitHub:

1. Navigate to your GitHub App settings (e.g., `https://github.com/apps/your-terrateam-app`)
2. Click on "App settings" on the right side under the Install button
3. Check the box "Request user authorization (OAuth) during installation"
4. Set the callback URL to: `https://terrateam.example.com/api/github/v1/callback`
5. Save your changes
6. Access your Terrateam UI at: `https://terrateam.example.com`

:::note[OAuth Callback]
The callback URL must match your deployment's FQDN with the path `/api/github/v1/callback`
:::

#### GitLab
The GitLab UI access is configured through the Personal Access Token setup during installation.

### Install Application

#### GitHub
1. Navigate to your GitHub Application settings page
2. Click "Install App" and select repositories
3. Complete the installation

#### GitLab
1. Ensure your Personal Access Token has the required scopes
2. Configure webhooks for each project as described above
3. Test the webhook connection from GitLab settings

## Scaling and High Availability

### Horizontal Scaling

Scale the number of Terrateam server replicas:

```sh
helm upgrade terrateam terrateamio/terrateam \
  --set server.replicas=3
```

### Database High Availability

For production workloads, consider:
- External managed PostgreSQL (AWS RDS, Google Cloud SQL, Azure Database)
- PostgreSQL cluster with automatic failover
- Regular database backups

### Load Balancing

The Helm chart automatically configures load balancing when multiple replicas are used. Health checks are performed on the `/health` endpoint.

## Monitoring and Logging

### Health Checks

Terrateam provides health check endpoints:
- `/health` - Overall application health
- `/metrics` - Prometheus metrics (if enabled)

### Viewing Logs

```sh
# View all Terrateam logs
kubectl logs -l app.kubernetes.io/name=terrateam

# Follow logs from specific pod
kubectl logs -f <pod-name>

# View database logs
kubectl logs -l app.kubernetes.io/name=postgresql
```

## Maintenance

### Updates

Update to the latest Terrateam version:

```sh
helm repo update
helm upgrade terrateam terrateamio/terrateam
```

### Rolling Restarts

Perform rolling restart without downtime:

```sh
kubectl rollout restart deployment/terrateam-server
```

### Backup and Recovery

**Database Backup:**
```sh
kubectl exec -it <postgres-pod> -- pg_dump -U terrateam terrateam > backup.sql
```

**Restore Database:**
```sh
kubectl exec -i <postgres-pod> -- psql -U terrateam -d terrateam < backup.sql
```

## Advanced Configuration

### GitHub Enterprise Server

For GitHub Enterprise Server deployments:

```yaml
server:
  env:
    GITHUB_API_BASE_URL: "https://api.github.example.com"
    GITHUB_WEB_BASE_URL: "https://github.example.com"
```

### GitLab Self-Hosted

For self-hosted GitLab instances:

```yaml
server:
  env:
    GITLAB_API_BASE_URL: "https://gitlab.example.com/api/v4"
    GITLAB_WEB_BASE_URL: "https://gitlab.example.com"
```

## Next Steps

After successful deployment:
1. Review [Best Practices](/self-hosted/best-practices/) for production operations
2. Set up monitoring and alerting
3. Configure backup and disaster recovery procedures
4. Plan for capacity scaling as usage grows
